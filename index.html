<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ask Me Anything ‚Äî Atlas Nusantara AI</title>
  <style>
    :root {
      --primary-blue: #60A5FA;
      --secondary-pink: #EC4899;
      --gray-text: #6B7280;
      --bg-white: #ffffff;
      --placeholder-gray: #9CA3AF;
      --tech-blue: #38bdf8;
    }

    html,body { height:100%; }
    body {
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
      background: linear-gradient(135deg, var(--primary-blue), var(--secondary-pink));
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      box-sizing: border-box;
    }

    .robot-head {
      position: relative;
      width: 80px;
      height: 80px;
      background: linear-gradient(145deg, #e0e0e0, #ffffff);
      border-radius: 50%;
      box-shadow:
        0 0 20px rgba(56, 189, 248, 0.6),
        inset 0 0 10px rgba(255, 255, 255, 0.8);
      animation: nod 6s infinite ease-in-out;
      z-index: 10;
    }

    .robot-head::before {
      content: "";
      position: absolute;
      top: 20px;
      left: 15px;
      width: 20px;
      height: 10px;
      background: white;
      border-radius: 50%;
      box-shadow: 25px 0 0 white;
    }

    .glasses {
      position: absolute;
      top: 18px;
      left: 12px;
      width: 56px;
      height: 20px;
      background: white;
      border-radius: 10px;
      border: 2px solid #cbd5e1;
      box-shadow: 0 0 10px rgba(56, 189, 248, 0.7);
    }

    .glasses::before,
    .glasses::after {
      content: "";
      position: absolute;
      top: 5px;
      width: 16px;
      height: 16px;
      background: #e2e8f0;
      border-radius: 50%;
      box-shadow: inset 0 0 8px rgba(56, 189, 248, 0.9);
    }

    .glasses::before { left:3px; }
    .glasses::after { right:3px; }

    @keyframes nod {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-4px) rotate(-1deg); }
      50% { transform: translateY(0) rotate(0deg); }
      75% { transform: translateY(-2px) rotate(1deg); }
    }

    .title {
      color: white;
      font-size: 22px;
      font-weight: 700;
      text-align: center;
      max-width: 90%;
      line-height: 1.3;
      text-shadow: 0 1px 2px rgba(0,0,0,0.15);
      margin-top: -18px;
    }

    .ask-box {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--bg-white);
      border-radius: 50px;
      padding: 12px 18px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      width: 640px;
      max-width: 98%;
      transition: all 0.25s ease;
    }

    .ask-box:hover { box-shadow: 0 8px 30px rgba(0,0,0,0.18); }

    .ask-box .icon, .generate-btn {
      font-size: 18px;
      color: var(--gray-text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      transition: background 0.2s;
      user-select: none;
    }

    .ask-box .icon:hover, .generate-btn:hover { background: #f3f4f6; }

    .ask-box input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 15px;
      color: var(--gray-text);
      background: transparent;
      min-width: 0;
    }

    .ask-box input::placeholder { color: var(--placeholder-gray); }

    .send-btn, .tech-btn, .announce-btn {
      background: linear-gradient(90deg, var(--primary-blue), var(--secondary-pink));
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: none;
    }

    .send-btn:hover, .tech-btn:hover, .announce-btn:hover {
      transform: scale(1.08);
      box-shadow: 0 6px 14px rgba(96, 165, 250, 0.28);
    }

    .response {
      background: white;
      padding: 16px 20px;
      border-radius: 12px;
      max-width: 640px;
      width: 98%;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      color: #374151;
      font-size: 15px;
      line-height: 1.5;
      text-align: left;
      white-space: pre-wrap;
      min-height: 48px;
    }

    #imageContainer { margin-top: 6px; max-width:640px; width:98%; display:flex; flex-direction:column; gap:8px; align-items:flex-start; }
    #imageContainer img { max-width:100%; height:auto; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.12); }
    #imageContainer p { margin:0; font-size:14px; color:#374151; }

    .hint { color: rgba(255,255,255,0.9); font-size:13px; margin-top:6px; }

    @media (max-width: 560px) {
      .ask-box { padding: 10px 12px; gap:8px; }
      .send-btn, .tech-btn, .announce-btn { width:36px; height:36px; font-size:14px; }
      .robot-head { width:60px; height:60px; }
      .title { font-size:18px; }
    }
  </style>
</head>
<body>
  <div class="robot-head">
    <div class="glasses"></div>
  </div>

  <div class="title">Ask Me Anything ‚Äî Atlas Nusantara AI üéª</div>

  <div class="ask-box" role="group" aria-label="Kotak tanya">
    <button class="generate-btn" id="generateBtn" title="Hasilkan gambar dan deskripsi">Ôºã</button>
    <button class="announce-btn" id="announceBtn" title="Cari sumber lebih dalam">üì£</button>
    <span class="icon" aria-hidden="true">üó∫Ô∏è</span>
    <input type="text" placeholder="Tanyakan sesuatu... (mis. 'apa itu rendang' atau 'jelaskan present tense')" id="userInput" />
    <button class="tech-btn" id="techBtn" title="Cari tentang teknologi">üåê</button>
    <div class="send-btn" id="sendBtn" title="Kirim pertanyaan">‚úàÔ∏è</div>
  </div>

  <div id="response" class="response" style="display:none;"></div>

  <div id="imageContainer" style="display:none;">
      <img id="generatedImage" src="" alt="Generated Image">
      <p id="imageDescription"></p>
  </div>

  <div class="hint">Tip: coba tanya dengan kata kunci yang ada di knowledge base, contoh: "tari", "tabel periodik", "present tense", "adjective", "descriptive text".</div>

<script>
/*
  Atlas Nusantara AI ‚Äî local knowledge-based responder
  - Data lama tetap utuh
  - Data terbaru ditambahkan di bagian terpisah: dataTerbaru
  - Simple keyword matching (case-insensitive)
  - generateBtn membuat gambar SVG cepat & deskripsi
  - tidak memanggil API eksternal -> offline / aman
  - PERBAIKAN: integrasi penuh dataTerbaru ke pencarian
  - PERBAIKAN: typo di irregularVerbs
*/

const knowledgeBase = {
  // === DATA LAMA ===
  budaya: {
    keywords: ['budaya', 'adat', 'tradisi', 'kesenian', 'tari', 'rumah adat', 'makanan khas', 'seni', 'nusantara'],
    pengertian: "Budaya Nusantara adalah keseluruhan cara hidup masyarakat Indonesia yang mencakup nilai, norma, seni, adat istiadat, dan kepercayaan.",
    tari: ["Tari Saman (Aceh)", "Tari Pendet (Bali)", "Tari Reog Ponorogo (Jawa Timur)", "Tari Tor-Tor (Batak)"],
    rumahAdat: ["Rumah Gadang (Minangkabau)", "Joglo (Jawa)", "Tongkonan (Toraja)", "Honai (Papua)"],
    makanan: ["Rendang (Sumatra Barat)", "Gudeg (Yogyakarta)", "Papeda (Maluku/Papua)", "Soto Banjar (Kalimantan Selatan)"]
  },
  nkri: {
    keywords: ['nkri', 'negara kesatuan', 'indonesia', 'pemerintahan pusat', 'jakarta', 'bentuk negara'],
    pengertian: "Negara Kesatuan Republik Indonesia (NKRI) adalah bentuk negara Indonesia yang bersatu dengan satu pemerintahan pusat.",
    manfaat: ["Menjaga persatuan", "Memudahkan koordinasi pemerintahan", "Memperkuat identitas nasional"],
    contoh: "Semua provinsi di Indonesia berada di bawah satu pemerintahan pusat di Jakarta."
  },
  bhinnekaTunggalIka: {
    keywords: ['bhinneka', 'bhinneka tunggal ika', 'berbeda tetap satu', 'toleransi', 'keberagaman', 'semboyan', 'indonesia'],
    pengertian: "Bhinneka Tunggal Ika berarti 'Berbeda-beda tetapi tetap satu', semboyan resmi Indonesia yang mencerminkan persatuan dalam keberagaman.",
    nilaiPancasila: "Sila ke-2 (Kemanusiaan yang Adil dan Beradab) dan Sila ke-3 (Persatuan Indonesia).",
    manfaat: ["Memperkuat toleransi", "Mencegah konflik SARA", "Membangun kebersamaan"],
    contoh: "Perayaan hari besar agama bersama tanpa membedakan suku dan agama."
  },
  pancasila: {
    keywords: ['pancasila', 'sila', 'dasar negara', 'ideologi', 'lima sila', 'falsafah'],
    pengertian: "Pancasila adalah dasar negara dan ideologi bangsa Indonesia yang terdiri dari lima sila sebagai pedoman kehidupan berbangsa dan bernegara.",
    sila1: "Ketuhanan Yang Maha Esa",
    sila2: "Kemanusiaan yang Adil dan Beradab",
    sila3: "Persatuan Indonesia",
    sila4: "Kerakyatan yang Dipimpin oleh Hikmat Kebijaksanaan dalam Permusyawaratan/Perwakilan",
    sila5: "Keadilan Sosial bagi Seluruh Rakyat Indonesia"
  },
  hikayat: {
    keywords: ['hikayat', 'cerita lama', 'prosa lama', 'sastra melayu klasik'],
    pengertian: "Hikayat adalah karya sastra prosa lama Melayu yang menceritakan kehidupan tokoh bangsawan, pahlawan, atau raja-raja di masa lampau.",
    tujuan: "Menghibur, menyampaikan nilai moral, melestarikan sejarah, dan menanamkan ajaran agama/etika.",
    struktur: "1. Pembukaan (doa/salawat), 2. Isi (alur cerita), 3. Penutup (nasihat/moral).",
    kaidahKebahasaan: "Menggunakan bahasa Melayu klasik, kata arkais (kuno), kalimat pasif, repetisi, metafora, dan hiperbola.",
    contoh: "Hikayat Hang Tuah, Hikayat Si Miskin, Hikayat Abdullah, Hikayat Bayan Budiman."
  },
  laporanHasilObservasi: {
    keywords: ['laporan hasil observasi', 'teks observasi', 'pengamatan', 'objek', 'deskripsi'],
    pengertian: "Teks laporan hasil observasi adalah teks yang berisi informasi faktual hasil pengamatan sistematis terhadap suatu objek.",
    tujuan: "Memberikan informasi objektif berdasarkan fakta pengamatan.",
    struktur: "1. Pernyataan umum (klasifikasi objek), 2. Deskripsi bagian (ciri fisik, perilaku, fungsi, dll).",
    ciriKebahasaan: "Menggunakan kata teknis, verba material (melihat, mengamati), kalimat definisi, bersifat objektif, dan tidak memakai opini pribadi.",
    contoh: "Laporan pengamatan kupu-kupu: siklus hidup, warna sayap, habitat, cara makan."
  },
  narrativeText: {
    keywords: ['narrative text', 'cerita naratif', 'english story', 'orientation complication resolution'],
    pengertian: "Narrative text is a genre of writing that tells a story about past events to entertain readers.",
    orientation: "Introduces characters, setting, and time. Example: 'Once upon a time, there lived a kind princess in a castle.'",
    complication: "The main problem or conflict arises. Example: 'One day, an evil witch cursed the princess to sleep forever.'",
    resolution: "The problem is solved. Example: 'A brave prince kissed her, and the curse was broken.'",
    ciriKebahasaanInggris: "Uses past tense, action verbs, time connectives (once, then, finally), and direct/indirect speech.",
    contoh: "Cinderella, Snow White, The Legend of Malin Kundang (adapted)."
  },
  teknologi: {
    keywords: ['teknologi', 'perangkat keras', 'hardware', 'perangkat lunak', 'software', 'aplikasi', 'gadget', 'komputer', 'hp'],
    pengertian: "Menurut KBBI, teknologi adalah metode ilmiah untuk mencapai tujuan praktis; ilmu pengetahuan terapan yang digunakan untuk memudahkan interaksi dan aktivitas manusia, termasuk dalam bermedia sosial.",
    perangkatKeras: ["Handphone (HP)", "Komputer", "Laptop", "Tablet", "Server", "Printer", "Router"],
    perangkatLunak: ["Aplikasi berhitung (kalkulator)", "Aplikasi pembayaran (GoPay, OVO, DANA)", "Sistem operasi (Windows, Android, iOS)", "Browser (Chrome, Firefox)", "Aplikasi media sosial (Instagram, WhatsApp, TikTok)"],
    manfaat: ["Mempermudah komunikasi", "Mempercepat akses informasi", "Meningkatkan efisiensi kerja", "Mendukung pembelajaran jarak jauh"]
  },
  majas: {
    keywords: ['majas', 'gaya bahasa', 'personifikasi', 'metafora', 'ironi', 'hiperbola'],
    pengertian: "Majas atau gaya bahasa adalah penggunaan kata-kata secara kiasan untuk menciptakan efek tertentu dalam karya sastra.",
    personifikasi: {
      pengertian: "Memberikan sifat manusia pada benda mati atau konsep abstrak.",
      contoh: "Angin berbisik pelan di telingaku."
    },
    metafora: {
      pengertian: "Perbandingan langsung tanpa kata pembanding (seperti, bagai).",
      contoh: "Dunia adalah panggung sandiwara."
    },
    ironi: {
      pengertian: "Mengatakan sesuatu yang bertentangan dengan maksud sebenarnya untuk menyindir.",
      contoh: "Wah, hebat sekali kamu sampai lupa ulang tahun ibumu!"
    },
    hiperbola: {
      pengertian: "Pengungkapan berlebihan untuk menekankan sesuatu.",
      contoh: "Aku sudah menunggumu berabad-abad!"
    }
  },
  keuangan: {
    keywords: ['keuangan', 'bank', 'non bank', 'lembaga keuangan', 'akuntansi', 'laporan keuangan', 'uang', 'investasi'],
    pengertian: "Keuangan adalah segala aktivitas yang berkaitan dengan pengelolaan uang, termasuk investasi, pinjaman, dan penganggaran.",
    perbankan: {
      pengertian: "Lembaga keuangan yang menghimpun dana dari masyarakat (simpanan) dan menyalurkannya kembali (kredit).",
      jenis: ["Bank Umum (BCA, BRI, Mandiri)", "Bank Perkreditan Rakyat (BPR)"],
      fungsi: ["Menciptakan uang giral", "Menyalurkan kredit", "Menyediakan jasa lalu lintas pembayaran"]
    },
    nonBank: {
      pengertian: "Lembaga keuangan yang tidak menghimpun dana dalam bentuk simpanan.",
      contoh: ["OJK", "Asuransi (Jiwasraya, Prudential)", "Dana Pensiun", "Perusahaan Efek", "Fintech (Pinjaman online)"]
    },
    akuntansi: {
      pengertian: "Proses pencatatan, penggolongan, peringkasan, dan pelaporan transaksi keuangan.",
      laporanKeuangan: ["Neraca", "Laporan Laba Rugi", "Arus Kas", "Perubahan Ekuitas"],
      prinsip: ["Relevansi", "Keandalan", "Konsistensi", "Daya Banding"]
    },
    istilahKeuangan: {
      likuiditas: "Kemampuan perusahaan membayar kewajiban jangka pendek.",
      solvabilitas: "Kemampuan membayar seluruh kewajiban (jangka panjang & pendek).",
      ROI: "Return on Investment ‚Äî ukuran keuntungan relatif terhadap investasi.",
      inflasi: "Kenaikan harga barang/jasa secara umum dalam periode tertentu."
    }
  },
  englishTenses: {
    keywords: ['present tense', 'past tense', 'simple present', 'simple past', 'rumus present', 'rumus past', 'tenses inggris', 'regular verb', 'irregular verb', 'kata kerja'],
    pengertian: "Tenses adalah bentuk kata kerja (verb) yang menunjukkan waktu terjadinya suatu peristiwa: masa kini (present), lampau (past), atau akan datang (future).",
    presentTense: {
      pengertian: "Digunakan untuk kebiasaan, fakta umum, atau kejadian rutin.",
      rumus: {
        positif: "S + V1 (s/es) + O/C\nContoh: She plays violin every day.",
        negatif: "S + do/does + not + V1 + O/C\nContoh: They do not like spicy food.",
        tanya: "Do/Does + S + V1 + O/C?\nContoh: Do you study English?"
      },
      catatan: "Tambahkan -s/-es pada verb jika subjek: he, she, it."
    },
    pastTense: {
      pengertian: "Digunakan untuk kejadian yang sudah selesai di masa lampau.",
      rumus: {
        positif: "S + V2 + O/C\nContoh: I watched a movie yesterday.",
        negatif: "S + did + not + V1 + O/C\nContoh: She did not go to school.",
        tanya: "Did + S + V1 + O/C?\nContoh: Did they visit Bali last year?"
      }
    },
    regularVerbs: {
      pengertian: "Kata kerja beraturan: bentuk kedua & ketiga dibuat dengan menambahkan -ed.",
      contoh: [
        "play ‚Äì played ‚Äì played",
        "watch ‚Äì watched ‚Äì watched",
        "clean ‚Äì cleaned ‚Äì cleaned",
        "study ‚Äì studied ‚Äì studied"
      ]
    },
    irregularVerbs: {
      // ‚úÖ DIPERBAIKI: typo diperbaiki
      pengertian: "Kata kerja **tidak beraturan**: bentuk kedua & ketiga tidak mengikuti pola -ed.",
      contohLengkap: [
        "go ‚Äì went ‚Äì gone",
        "eat ‚Äì ate ‚Äì eaten",
        "see ‚Äì saw ‚Äì seen",
        "take ‚Äì took ‚Äì taken",
        "write ‚Äì wrote ‚Äì written",
        "sing ‚Äì sang ‚Äì sung",
        "drink ‚Äì drank ‚Äì drunk",
        "break ‚Äì broke ‚Äì broken",
        "do ‚Äì did ‚Äì done",
        "have ‚Äì had ‚Äì had"
      ]
    }
  },
  narrativeStructure: {
    keywords: ['struktur narrative text', 'orientation complication resolution', 'evaluation coda', 'bagian cerita naratif', 'coda', 'evaluation'],
    pengertian: "Struktur teks naratif terdiri dari lima bagian utama yang membentuk alur cerita yang utuh.",
    orientation: "Memperkenalkan tokoh, latar (tempat & waktu), dan suasana awal.\nContoh: Once upon a time, there was a kind girl named Cinderella.",
    complication: "Munculnya konflik atau masalah dalam cerita.\nContoh: Her stepmother forbade her from attending the royal ball.",
    resolution: "Pemecahan masalah atau penyelesaian konflik.\nContoh: With the help of her fairy godmother, she went to the ball and met the prince.",
    evaluation: "Penilaian terhadap peristiwa atau pelajaran moral (opsional, sering menyatu dengan resolution).",
    coda: "Kesimpulan atau akhir cerita yang menunjukkan perubahan kondisi tokoh.\nContoh: They lived happily ever after."
  },
  tabelPeriodik: {
    keywords: ['tabel periodik', 'unsur kimia', 'simbol unsur', 'unsur', 'campuran kimia', 'rumus kimia', 'H2O', 'NaCl', 'CO2'],
    pengertian: "Tabel periodik adalah susunan unsur-unsur kimia yang diatur berdasarkan kenaikan nomor atom dan kemiripan sifat kimianya.",
    simbolUnsur: "Setiap unsur memiliki simbol unik, contoh: H (Hidrogen), O (Oksigen), Fe (Besi), Na (Natrium), Cl (Klorin).",
    campuranUmum: [
      "Air (H‚ÇÇO) ‚Äî gabungan hidrogen dan oksigen",
      "Garam dapur (NaCl) ‚Äî natrium + klorin",
      "Karbon dioksida (CO‚ÇÇ) ‚Äî karbon + oksigen",
      "Amonia (NH‚ÇÉ) ‚Äî nitrogen + hidrogen"
    ],
    manfaat: [
      "Memprediksi sifat dan reaktivitas unsur",
      "Dasar pengembangan obat dan material baru",
      "Digunakan di industri logam, energi, dan pertanian",
      "Alat pembelajaran wajib di sekolah"
    ],
    contohUnsur: [
      "Oksigen (O‚ÇÇ) ‚Äî untuk bernapas",
      "Besi (Fe) ‚Äî bahan bangunan dan kendaraan",
      "Tembaga (Cu) ‚Äî kabel listrik",
      "Karbon (C) ‚Äî dasar kehidupan dan bahan bakar"
    ]
  },
  perubahanZatDanLingkungan: {
    keywords: ['perubahan fisika', 'perubahan kimia', 'biotik', 'abiotik', 'wujud zat', 'mengembun', 'menyublim', 'menguap', 'membeku', 'mencair', 'deposisi', 'perubahan iklim', 'karbon dioksida'],
    biotikAbiotik: {
      biotik: "Benda hidup yang bisa tumbuh, berkembang biak, dan mati.\nContoh: manusia, hewan, tumbuhan, bakteri.",
      abiotik: "Benda mati yang tidak memiliki ciri makhluk hidup.\nContoh: batu, air, udara, kayu (setelah ditebang), tanah."
    },
    perubahanFisika: {
      pengertian: "Perubahan bentuk atau wujud tanpa menghasilkan zat baru (reversibel).",
      contoh: "Es mencair ‚Üí air ‚Üí dibekukan lagi jadi es.",
      ciri: "Tidak ada zat baru, hanya berubah wujud."
    },
    perubahanKimia: {
      pengertian: "Perubahan yang menghasilkan zat baru (ireversibel).",
      contoh: "Kayu dibakar ‚Üí jadi arang dan asap, susu basi, besi berkarat.",
      ciri: "Terbentuk zat baru, tidak bisa dikembalikan."
    },
    perubahanWujud: {
      mencair: "Padat ‚Üí cair (es ‚Üí air)",
      membeku: "Cair ‚Üí padat (air ‚Üí es)",
      menguap: "Cair ‚Üí gas (air ‚Üí uap)",
      mengembun: "Gas ‚Üí cair (uap ‚Üí air)",
      menyublim: "Padat ‚Üí gas (kapur barus menguap)",
      deposisi: "Gas ‚Üí padat (uap air ‚Üí salju)"
    },
    perubahanIklim: {
      pengertian: "Perubahan jangka panjang pola cuaca akibat pemanasan global.",
      penyebab: "Emisi gas rumah kaca (CO‚ÇÇ, metana) dari kendaraan, pabrik, dan deforestasi.",
      dampak: "Es kutub mencair ‚Üí permukaan laut naik ‚Üí banjir di wilayah pesisir.",
      solusi: "Gunakan energi terbarukan, tanam pohon, kurangi sampah plastik."
    }
  },
  norma: {
    keywords: ['norma', 'aturan', 'sosial', 'kesopanan', 'agama', 'hukum', 'kebiasaan', 'norma sekolah', 'norma keluarga'],
    pengertian: "Norma adalah aturan atau pedoman yang mengatur perilaku dalam masyarakat.",
    jenis: ["Norma agama", "Norma hukum", "Norma kesopanan", "Norma kebiasaan"],
    contohSehariHari: [
      "Tidak boleh mencuri (norma hukum & agama)",
      "Antri saat beli makanan (norma kesopanan)",
      "Pakai seragam sekolah (norma sekolah)",
      "Bantu orang tua di rumah (norma keluarga)"
    ],
    tempatBerlaku: "Berlaku di rumah, sekolah, tempat ibadah, masyarakat umum, dan negara"
  },
  analisisCerita: {
    keywords: ['latar tempat', 'latar waktu', 'latar suasana', 'tema', 'tokoh', 'penokohan', 'abstraksi', 'orientasi', 'komplikasi', 'evaluasi', 'resolusi', 'koda', 'unsur intrinsik'],
    latarTempat: "Lokasi terjadinya cerita (misal: sekolah, hutan, kota, istana).",
    latarWaktu: "Waktu kejadian cerita (pagi, siang, malam, zaman dahulu, masa depan).",
    latarSuasana: "Suasana emosional dalam cerita (sedih, tegang, bahagia, mencekam, haru).",
    tema: "Gagasan pokok atau pesan utama yang muncul di seluruh cerita (misal: cinta, pengorbanan, keadilan).",
    tokoh: "Pelaku atau karakter dalam cerita (tokoh utama, tokoh antagonis, tokoh pendukung).",
    penokohan: "Cara pengarang menggambarkan sifat tokoh (langsung: 'Si Fulan jujur', tidak langsung: lewat dialog/perilaku).",
    abstraksi: "Gambaran umum atau ringkasan awal cerita (sering muncul di teks eksposisi atau naratif modern).",
    orientasi: "Bagian awal cerita yang memperkenalkan tokoh, latar, dan suasana.",
    komplikasi: "Rangkaian peristiwa yang memunculkan konflik atau masalah.",
    evaluasi: "Penilaian terhadap perkembangan peristiwa atau konflik (opsional, sering menyatu dengan resolusi).",
    resolusi: "Penyelesaian dari konflik atau masalah dalam cerita.",
    koda: "Amanat, pesan moral, atau kesimpulan di akhir cerita (misal: 'Jadilah jujur dalam segala hal.')."
  },

  // === DATA TERBARU ‚Äî DIINTEGRASIKAN LANGSUNG KE knowledgeBase ===
  adjective: {
    keywords: ['adjective', 'adjective bahasa indonesia'],
    pengertian: "Adjective (kata sifat) adalah kata yang memberi keterangan pada kata benda (noun) atau pronoun untuk menjelaskan kualitas, ukuran, warna, dsb.",
    contoh: ["beautiful (cantik)", "big (besar)", "ancient (kuno)", "famous (terkenal)"],
    fungsi: "Menjelaskan sifat atau keadaan benda: quality (good), size (small), age (old), color (red), origin (Indonesian).",
    posisi: "Dalam Bahasa Inggris, adjective umumnya sebelum noun: 'a red car', sedangkan dalam Bahasa Indonesia biasanya setelah noun atau sebelum tergantung struktur: 'rumah besar' atau 'besar rumah' (umum: 'rumah besar')."
  },
  adverb: {
    keywords: ['adverb', 'adverb manner', 'adverb frequency', 'adverb time', 'adverb place'],
    pengertian: "Adverb (kata keterangan) memberi keterangan pada verb, adjective, atau adverb lainnya. Terdapat beberapa tipe: manner, frequency, time, place.",
    manner: {
      pengertian: "Adverb of manner menjelaskan bagaimana suatu tindakan dilakukan.",
      contoh: ["quickly (dengan cepat)", "slowly (dengan pelan)", "carefully (dengan hati-hati)"],
      contohKalimat: ["She sings beautifully. ‚Äî Dia bernyanyi dengan indah.", "He writes neatly."]
    },
    frequency: {
      pengertian: "Adverb of frequency menunjukkan seberapa sering suatu kejadian terjadi.",
      contoh: ["always (selalu)", "often (sering)", "sometimes (kadang-kadang)", "never (tidak pernah)"],
      contohKalimat: ["I always brush my teeth in the morning."]
    },
    time: {
      pengertian: "Adverb of time menunjukkan kapan sesuatu terjadi.",
      contoh: ["yesterday (kemarin)", "today (hari ini)", "tomorrow (besok)", "now (sekarang)"],
      contohKalimat: ["They arrived yesterday."]
    },
    place: {
      pengertian: "Adverb of place menunjukkan lokasi/arah.",
      contoh: ["here (di sini)", "there (di sana)", "everywhere (di mana-mana)"],
      contohKalimat: ["Put it there, please."]
    }
  },
  imperative: {
    keywords: ['imperative'],
    pengertian: "Kalimat imperative memberi perintah, instruksi, atau ajakan. Biasanya subjek (you) dihilangkan dalam bentuk positif.",
    contoh: ["Please sit down. ‚Äî Tolong duduk.", "Don't touch that! ‚Äî Jangan sentuh itu!"],
    bentuk: {
      positif: "Verb dasar + objek (opsional). Contoh: 'Close the door.'",
      negatif: "Do not (don't) + verb. Contoh: 'Don't run in the hall.'",
      sopan: "Gunakan 'please' atau 'could you' untuk lebih sopan. Contoh: 'Please pass the salt.'"
    },
    catatan: "Imperative juga dipakai untuk memberi instruksi pada resep, petunjuk laboratorium, tanda, atau aturan sekolah."
  },
  descriptiveText: {
    keywords: ['descriptive text'],
    pengertian: "Descriptive text adalah teks yang menggambarkan karakteristik suatu objek, tempat, atau orang dengan rinci.",
    struktur: ["Identification (identifikasi objek)", "Description (deskripsi bagian dan sifat)"],
    kaidahBahasa: ["Kata sifat (adjectives)", "Adverb untuk keterangan tambahan", "Klausa deskriptif"],
    contohPendek: "My grandmother's house is old and charming. It has wooden floors and a garden full of fragrant flowers.",
    contohPanjang: "The Borobudur Temple is an ancient Buddhist monument located on a hill. The stone reliefs are intricate and the structure gives a feeling of grandeur."
  },
  recountText: {
    keywords: ['recount text'],
    pengertian: "Recount text adalah teks yang menceritakan kembali peristiwa masa lalu secara kronologis untuk memberi informasi atau rekaman pengalaman.",
    tujuan: "Untuk menceritakan apa yang terjadi di masa lampau (personal experience, news report, historical events).",
    struktur: ["Orientation (setting and participants)", "Events (sequence of events)", "Re-orientation or personal comment (opsional)"],
    contohPendek: "Yesterday, I visited my uncle. We had lunch and then went for a walk in the park.",
    contohPanjang: "Last summer, our family went to Yogyakarta. First, we visited Prambanan; then we tried batik-making. On the last day, we enjoyed Gudeg before heading home."
  }
};

// Utility: flatten keyword map for quick search
function buildKeywordIndex(kb) {
  const index = [];
  for (const key of Object.keys(kb)) {
    const section = kb[key];
    if (section && section.keywords && Array.isArray(section.keywords)) {
      for (const kw of section.keywords) {
        index.push({ keyword: kw.toLowerCase(), key });
      }
    } else {
      // If no explicit keywords array, also accept the property name
      index.push({ keyword: key.toLowerCase(), key });
    }
  }
  return index;
}
const keywordIndex = buildKeywordIndex(knowledgeBase);

// Format an object/section to readable string
function formatSection(title, section) {
  if (!section) return `${title}: (tidak ada data)`;
  if (typeof section === 'string') return `${title}:\n${section}`;
  if (Array.isArray(section)) return `${title}:\n- ${section.join('\n- ')}`;
  // Object: iterate keys
  let out = `${title}:\n`;
  for (const prop of Object.keys(section)) {
    const val = section[prop];
    if (typeof val === 'string') {
      out += `${prop}: ${val}\n`;
    } else if (Array.isArray(val)) {
      out += `${prop}: \n  - ${val.join('\n  - ')}\n`;
    } else if (typeof val === 'object') {
      out += `${prop}: \n`;
      // nested simple properties
      for (const sub of Object.keys(val)) {
        const v = val[sub];
        if (typeof v === 'string') {
          out += `    ${sub}: ${v}\n`;
        } else if (Array.isArray(v)) {
          out += `    ${sub}: ${v.join(', ')}\n`;
        } else if (typeof v === 'object') {
          out += `    ${sub}: ${JSON.stringify(v)}\n`;
        }
      }
    } else {
      out += `${prop}: ${String(val)}\n`;
    }
  }
  return out;
}

// Main search function: finds best-matching sections by keyword contained in input
function searchKnowledge(query) {
  const q = query.toLowerCase().trim();
  if (!q) return { type: 'error', text: "Masukkan pertanyaan atau kata kunci terlebih dahulu." };

  // direct match on keywords
  const matches = new Map();
  for (const entry of keywordIndex) {
    if (q.includes(entry.keyword)) {
      matches.set(entry.key, knowledgeBase[entry.key]);
    }
  }

  // fallback: check if query equals a top-level key
  if (matches.size === 0) {
    if (knowledgeBase[q]) {
      matches.set(q, knowledgeBase[q]);
    }
  }

  // If still nothing, try fuzzy partial: check each keyword presence as separate word
  if (matches.size === 0) {
    const words = q.split(/\s+/);
    for (const w of words) {
      for (const entry of keywordIndex) {
        if (entry.keyword === w) matches.set(entry.key, knowledgeBase[entry.key]);
      }
    }
  }

  if (matches.size === 0) {
    // try to detect some common intents: "gambar", "image", "foto"
    if (q.includes('gambar') || q.includes('image') || q.includes('foto')) {
      return { type: 'imageOnly', text: "Minta gambar. Klik tombol + untuk menghasilkan gambar sederhana." };
    }
    return { type: 'notfound', text: "Maaf, saya tidak menemukan topik yang cocok. Coba gunakan kata kunci lain (mis. 'budaya', 'present tense', 'adjective', 'descriptive text')." };
  }

  // build readable response combining matched sections
  let resultText = "";
  for (const [key, section] of matches) {
    resultText += formatSection(key.toUpperCase(), section) + "\n\n";
  }
  return { type: 'ok', text: resultText.trim() };
}

// UI bindings
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const responseDiv = document.getElementById('response');
const imageContainer = document.getElementById('imageContainer');
const generatedImage = document.getElementById('generatedImage');
const imageDescription = document.getElementById('imageDescription');
const generateBtn = document.getElementById('generateBtn');
const techBtn = document.getElementById('techBtn');
const announceBtn = document.getElementById('announceBtn');

function showResponse(text) {
  responseDiv.style.display = 'block';
  responseDiv.textContent = text;
}

function hideResponse() {
  responseDiv.style.display = 'none';
  responseDiv.textContent = '';
}

function showImage(dataUrl, desc) {
  imageContainer.style.display = 'flex';
  generatedImage.src = dataUrl;
  imageDescription.textContent = desc || '';
}

function hideImage() {
  imageContainer.style.display = 'none';
  generatedImage.src = '';
  imageDescription.textContent = '';
}

// Send action
sendBtn.addEventListener('click', () => {
  hideImage();
  const q = userInput.value || '';
  const result = searchKnowledge(q);
  if (result.type === 'error') {
    showResponse(result.text);
  } else if (result.type === 'notfound') {
    showResponse(result.text);
  } else if (result.type === 'imageOnly') {
    showResponse(result.text);
  } else if (result.type === 'ok') {
    showResponse(result.text);
  }
});

// Allow Enter key to send
userInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendBtn.click();
  }
});

// Generate simple SVG image + description (client-side)
generateBtn.addEventListener('click', () => {
  const q = (userInput.value || 'Atlas Nusantara AI').trim();
  // build a simple SVG with gradient + text
  const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700">
    <defs>
      <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
        <stop offset="0" stop-color="#60A5FA"/>
        <stop offset="1" stop-color="#EC4899"/>
      </linearGradient>
    </defs>
    <rect width="100%" height="100%" fill="url(#g1)"/>
    <g transform="translate(60,120)" font-family="Segoe UI, Roboto, Arial">
      <rect x="0" y="0" rx="20" ry="20" width="1080" height="460" fill="rgba(255,255,255,0.12)"/>
      <text x="40" y="70" font-size="64" font-weight="700" fill="white">Atlas Nusantara AI</text>
      <text x="40" y="150" font-size="34" fill="white">Hasil visual untuk:</text>
      <foreignObject x="40" y="170" width="980" height="240">
        <div xmlns="http://www.w3.org/1999/xhtml" style="font-family:Segoe UI, Arial; color:white; font-size:26px; line-height:1.3; padding:10px;">
          ${escapeHtml(q).replace(/\n/g,'<br/>')}
        </div>
      </foreignObject>
    </g>
  </svg>`;

  const svgBlob = new Blob([svg], {type: 'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(svgBlob);
  showImage(url, `Gambar sederhana untuk: "${q}" ‚Äî (SVG dihasilkan lokal)`);
  showResponse(`Menghasilkan gambar sederhana untuk: "${q}". Deskripsi singkat:\nGambar ini menampilkan judul Atlas Nusantara AI dengan teks permintaanmu.`);
});

// techBtn: shortcut to search 'teknologi' section
techBtn.addEventListener('click', () => {
  userInput.value = 'teknologi';
  sendBtn.click();
});

// announceBtn: show summary of all new grammar topics
announceBtn.addEventListener('click', () => {
  hideImage();
  let fullText = "DATA TERBARU ‚Äî Topik Bahasa Inggris:\n\n";
  const newTopics = ['adjective', 'adverb', 'imperative', 'descriptiveText', 'recountText'];
  for (const topic of newTopics) {
    fullText += formatSection(topic.toUpperCase(), knowledgeBase[topic]) + "\n\n";
  }
  showResponse(fullText.trim());
});

// small helper to escape user text for SVG <foreignObject>
function escapeHtml(unsafe) {
  return unsafe.replace(/[&<"'>]/g, function(m) {
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]);
  });
}

// initial welcome
showResponse("Halo! Tanyakan sesuatu, mis. 'apa itu rendang', 'jelaskan present tense', 'adjective', atau klik üì£ untuk melihat data terbaru (adjective/adverb/imperative/descriptive/recount).");

// clean up object URL when window unloads
window.addEventListener('unload', () => {
  try {
    if (generatedImage && generatedImage.src.startsWith('blob:')) URL.revokeObjectURL(generatedImage.src);
  } catch(e){}
});
</script>
</body>
</html>